<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>01p-w</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta content="01p-w is the outcome of an in-depth research about the essence of photography, its influence on the construction of identity and the instruments for archiving imagery
	in the past and athe present. 01p-w is neither a further social network nor another app to publicly exhibit your private photos – 01p-w does just the opposite. It stands
	for radical limitation in a world of unlimited noise, for a conscious engagement with photography; a medium once a word of almost magical properties described as an
	emanation of reality."
    name="description">
  <meta content="01p-w" name="author">
  <meta content="http://01p-w.com/img/fb.png" property="og:image">
  <meta content="01p-w" property="og:title">
  <meta content="http://01p-w.com" property="og:url">
  <meta content="01p-w is the outcome of an in-depth research about the essence of photography, its influence on the construction of identity and the instruments for archiving imagery
	in the past and the present. 01p-w is neither a further social network nor another app to publicly exhibit your private photos – 01p-w does just the opposite. It stands
	for radical limitation in a world of unlimited noise, for a conscious engagement with photography; a medium once a word of almost magical properties described as an
  emanation of reality."
    property="og:description">
  <link href="./css/style.css" rel="stylesheet">
  <link href="./favicon.png" rel="shortcut icon">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
  <script defer src="./js/fullscreen.js"></script>

  <!-- update the version number as needed -->
  <script defer src="https://www.gstatic.com/firebasejs/5.5.2/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="https://www.gstatic.com/firebasejs/5.5.2/firebase-auth.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/5.5.2/firebase-storage.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/5.5.2/firebase-firestore.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="./js/init.js"></script>
</head>

<body>
  <header>
    <h1 id="logo">
      <a href="/" alt="Home">01p-w</a>
    </h1>
    <h1 id="user" class="hidden"></h1>
    <h1 id="logout" class="hidden">
      <a href="" onclick="signOut()">Logout</a>
    </h1>
    <h1 id="login">
      <a onclick="toggleUIElement('#loginfield')">Sign In</a>
    </h1>
  </header>
  <div class="optionbar">
    <ul class="optionleft hidden">
      <li><a href="mailto:support@01p-w.com">Support</a></li>
      <li><a id="termsofuselink" href="" onclick="return false">Terms of use</a></li>
      <li><a id="privacypolicylink" href="" onclick="return false">Privacy Policy</a></li>
    </ul>
    <ul class="optionright hidden">
      <li><a href="" onclick="profileSettings()">Settings</a></li>
      <li><a href="" onclick="signOut()">Log out</a></li>
    </ul>
  </div>
  <div id="description">
    <p>01p-w is the outcome of an in-depth research about the essence of photography, its influence on the construction
      of identity
      and the instruments for archiving imagery in the past and the present. 01p-w is neither an additional social
      network
      nor another app to publicly exhibit your private photos&mdash;01p-w does just the opposite. It stands for radical
      limitation
      in a world of unlimited noise, for conscious engagement with photography; a medium once a word of almost magical
      properties,
      described as an emanation of reality.</p>
  </div>

  <div id="termsofuse" class="fullpagetext hidden">
    <p>01p-w users: As of May 29, 2018, Fantastic Fox, Inc. has acquired Flickr. Your continued use of the Flickr
      services will be subject to these Terms of Use. These Terms of Use also apply to your use of the Services,
      where applicable, to purchase photographic prints, videos or other related merchandise, products and
      services (“Products”) through Flickr’s approved third party vendors and retailers (“Flickr Vendors”). For infor-
      mation about how Flickr collects, uses and discloses your information, please see the Flickr Pr</p>
  </div>
  <div id="privacypolicy" class="fullpagetext hidden">
    <p>01p-w users: As of May 29, 2018, Fantastic Fox, Inc. has acquired Flickr. Your continued use of the Flickr
      services will be subject to these Terms of Use. These Terms of Use also apply to your use of the Services,
      where applicable, to purchase photographic prints, videos or other related merchandise, products and
      services (“Products”) through Flickr’s approved third party vendors and retailers (“Flickr Vendors”). For infor-
      mation about how Flickr collects, uses and discloses your information, please see the Flickr Pr</p>
  </div>
  <div id="loginfield" class="up">
    <div id="lfield">
      <div id="closecross">
        <a href="" onclick="return false">
          <img src="img/greycross.png" />
        </a>
      </div>
      <form name="login" id="loginform" onsubmit="signIn(event)">
        <table>
          <tr>
            <td>Email
              <br>
              <input id="login_email" type="email" name="email" required>
            </td>
          </tr>
          <tr>
            <td>Password
              <span id="forgotpw">
                <a href="">Forgot it?</span>
              </a>
              <br>
              <input id="login_password" type="password" name="password" required>
            </td>
          </tr>
          <tr>
            <td>
              <div id="rememberme" class="checkbox">

                <input type="checkbox" id="rememberme" name="rememberme" />
                <label for="rememberme">
                  Remember me</label>
              </div>
              <div class="submit">
                <input type="submit" class="submitbutton" value="Login">
              </div>
            </td>
          </tr>
        </table>
        <!-- <span>Please enter the email address you use
to log in, and we’ll send you a link to reset
your password.</span>
<table>
          <tr>
            <td>Email
              <br>
              <input id="login_email" type="email" name="email" required>
            </td>
          </tr>  
       <tr>
            <td>
              <div class="submit">
                <input type="submit" class="submitbutton" value="Reset Password">
              </div>
            </td>
          </tr>
</table>
<span id="afterreset">Thank you! An email has been sent to
oliver.kerrison@neusicht.ch containing
a link to reset your password.</span>
-->
      </form>
      <div>
        <p id="login_error"></p>
      </div>
    </div>
    <div id="rfield">
      <form name="registration" id="registrationform" onsubmit="signUp(event)">
        <table>
          <tr>
            <td>
              <h2>Create an account</h2>
            </td>
          </tr>
          <tr>
            <td>First name
              <br>
              <input id="signup_firstname" type="text" name="firstname" required>
            </td>
          </tr>
          <tr>
            <td>Last name
              <br>
              <input id="signup_lastname" type="text" name="lastname" required>
            </td>
          </tr>
          <tr>
            <td>Email
              <br>
              <input id="signup_email" type="email" name="email" required>
            </td>
          </tr>
          <tr>
            <td>Confirm email
              <br>
              <input id="signup_confirmemail" type="email" name="confirmemail" required>
            </td>
          </tr>
          <tr>
            <td>Password
              <br>
              <input id="signup_password" type="password" name="password" required>
            </td>
          </tr>
          <tr>
            <td>Confirm password
              <br>
              <input id="signup_confirmpassword" type="password" name="confirmpassword" required>
            </td>
          </tr>
          <tr>
            <td>
              <div id="policy" class="checkbox">
                <input id="signup_policy" type="checkbox" name="policy" />
                <label for="policy">
                  I accept and have read the privacy
                  <br>policy and the membership policy.</label>
              </div>
              <div class="submit">
                <input type="submit" class="submitbutton" value="Sign up">
              </div>
            </td>
          </tr>
        </table>
      </form>
      <div>
        <p id="signup_error"></p>
      </div>
    </div>
  </div>
  <div id="profilefield" class="up hidden">
    <div id="pfield">
      <form name="profilesettings" id="settingform" onsubmit="signUp(event)">
        <table>
          <tr>
            <td>
              <h2>Edit your preferences below.</h2>
            </td>
          </tr>
          <tr>
            <td>First name
              <br>
              <input id="setting_firstname" type="text" name="firstname" required>
            </td>
          </tr>
          <tr>
            <td>Last name
              <br>
              <input id="setting_lastname" type="text" name="lastname" required>
            </td>
          </tr>
          <tr>
            <td>Email
              <br>
              <input id="setting_email" type="email" name="email" required>
            </td>
          </tr>
          <tr>
            <td>Confirm email
              <br>
              <input id="setting_confirmemail" type="email" name="confirmemail" required>
            </td>
          </tr>
          <tr>
            <td>Password
              <br>
              <input id="setting_password" type="password" name="password" required>
            </td>
          </tr>
          <tr>
            <td>Confirm password
              <br>
              <input id="setting_confirmpassword" type="password" name="confirmpassword" required>
            </td>
          </tr>
          <tr>
            <td>
              <div class="submit">
                <input type="submit" class="submitbutton" value="Save changes">
              </div>
            </td>
          </tr>
          <tr>
            <td><a href="" onclick="return false">Delete account?</a></td>
            <td></td>
          </tr>
        </table>
      </form>
      <div>
        <p id="signup_error"></p>
      </div>
    </div>

  </div>
  <div id="gallery" class="hidden">

    <div class="captionbar hidden">
      <span onclick="return false" class="currentweek">
        All</span>
      <span onclick="return false" class="currentyear">
        2018</span>
      <span class="fullscreen"></span>
      <span class="galeriebutton"></span>
    </div>

    <script id="entry-template" type="text/x-handlebars-template">
      {{#each images}}
        {{#if downloadUrl}}
          <article class="image inactive" data-piio-bck="{{downloadUrl}}">
            <div class="imageoption">
              <p class="number">{{label}}</p>
              <div class="buttons">
                <button class="deletesingle" data-id="{{id}}" onclick="deleteImage(event)">de</button>
                <button class="downloadsingle" data-id="{{id}}"><a href="{{downloadUrl}}" download>dw</a></button>
              </div>
            <div class="deletemessage hidden">Are you sure you want to delete this image?<br>
              <input type="submit" class="submitbutton" value="Yes">
              <input type="cancel" class="submitbutton" value="No">
            </div>
          </article>
        {{else}}
        <article class="image inactive" style="background-color: #9e9e9e;" onclick="document.querySelector('#addimageinput-{{id}}').click();">
          <div class="imageoption">
            <p class="number">{{label}}</p>
          </div>
          <div id="addimageelement">
            <input type="file" id="addimageinput-{{id}}" class="hidden" name="image" accept="image/*" data-id="{{id}}" onchange="addImage(event)">
            <span>+</span>
          </div>
        </article>
        {{/if}}
      {{/each}}
  </script>
  </div>
  <div id="single hidden">


    <script id="entry-template-single" type="text/x-handlebars-template">
 	 {{#each images}}
 <footer>
    <div id="captionbar">
      <span onclick="return false" class="currentweek">
                {{week}}</span>
            <span onclick="return false" class="currentyear">
                {{year}}</span><input class="captioninput" onFocus="if(this.value == this.defaultValue) this.value = '';" onblur = "if(!this.value) this.value = this.defaultValue;" value="[Insert Caption here]" id="captioninput" type="text" name="Caption"/>
{{caption}}
    </div>

        <article class="image inactive" style="background-image:url(media/46p-w_2018.jpg)"></article>
	  <ul class="dropdown" id="week">
				<li><a href="2018/01">01</a></li>
				<li class="emptycw">02</li>
				<li><a href="2018/03">03</a></li>
				<li><a href="2018/04">04</a></li>
				<li><a href="2018/05">05</a></li>
			</ul>

    <ul class="dropdown" id="year">
      <a href="https://01p-w.com/2018" alt="2018">
        <li>2018</li>
      </a>
    </ul>
  </footer>

<ul>
<li class="prev">
                        <a href="https://01p-w.com/2018/01/">
                        </a>
                    </li>
    <li class="top">
        <a href="https://01p-w.com/2018/">
            Übersicht (2018)
        </a>
    </li> 
    
                <li class="next">
                    <a href="https://01p-w.com/2018/02/">
                    </a>
                </li></ul>
 	 {{/each}}
 	  </script>
  </div>
  <!--  <article class="empty">
<inp
<span>

</span>
</article>  -->

  <!--<div id="popup" class="hidden">
    
		<p>Do you want to delete this image?</p>
		<br>
		<button>Yes</button>
    <button>No</button>


  </div>-->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      try {
        let app = firebase.app();
        const firestore = firebase.firestore();
        const settings = { timestampsInSnapshots: true };
        firestore.settings(settings);
        firebase.auth().onAuthStateChanged((user) => {
          if (user) {
            toggleUI();
            if (!user.displayName) {
              user.updateProfile({
                displayName: `${document.user.firstname} ${document.user.lastname}`
              }).then(function () {
                document.querySelector("#user").textContent = user.displayName;
              });
            } else {
              document.querySelector("#user").textContent = user.displayName;
            }

            getImagesByUserId(user.uid);
          }
        });

      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    });

    function signIn(event) {
      event.preventDefault();
      const email = document.querySelector("#login_email").value;
      const password = document.querySelector("#login_password").value;
      firebase.auth().signInWithEmailAndPassword(email, password).catch((error) => {
        console.error(`(signIn): (${error.code}) ${error.message}`);
        document.querySelector("#login_error").innerHTML = "Sorry we couldn't find you.</p> Please try again.";
      });
    }

    function toggleUIElement(element) {
      if (document.querySelector(element)) {
        document.querySelector(element).classList.toggle("hidden");
      }
    }

    function signOut() {
      firebase.auth().signOut().then(function () {
        toggleUI();
      });
    }

    function signUp(event) {
      event.preventDefault();
      const user = {
        firstname: document.querySelector("#signup_firstname").value,
        lastname: document.querySelector("#signup_lastname").value,
        email: document.querySelector("#signup_email").value,
        confirmemail: document.querySelector("#signup_confirmemail").value,
        password: document.querySelector("#signup_password").value,
        confirmpassword: document.querySelector("#signup_confirmpassword").value,
        policy: document.querySelector("#signup_policy").checked
      };

      if (validateSignUpForm(user)) {
        firebase.auth().createUserWithEmailAndPassword(user.email, user.password).catch((error) => {
          console.error(`(signUp): (${error.code}) ${error.message}`);
          signup_error("The user already exists. Please log in</br>or sign up with a new account.");
        });
        document.user = user;
      }
    }

    function validateSignUpForm(user) {
      if (!user.firstname || !user.lastname || !user.email || !user.confirmemail || !user.password || !user.confirmpassword) {
        signup_error("Please fill out all the fields");
        return false;
      }
      if (user.email !== user.confirmemail) {
        signup_error("Email adresses don't match");
        return false;
      }
      if (user.password !== user.confirmpassword) {
        signup_error("Passwords don't match");
        return false;
      }
      if (user.policy !== true) {
        signup_error("Privacy and membership policy must be accepted");
        return false;
      }
      return true;
    }

    function signup_error(message) {
      document.querySelector("#signup_error").innerHTML = message;
    }

    function toggleUI() {
      const elements = ["#user", "#login", "#logout", "#loginfield", "#gallery", "#popup", "#description"];
      for (const element of elements) {
        if (document.querySelector(element)) {
          document.querySelector(element).classList.toggle("hidden");
        }
      }
    }

    function getImagesByUserId(userId) {
      const ref = firebase.firestore().collection("images").where("uid", "==", userId).orderBy("year").orderBy("week");
      ref.get().then(async (querySnapshot) => {
        if (querySnapshot.size === 0) {
          for (let i = 1; i <= 7; i++) {
            const yearAndWeek = getYearAndWeek(new Date());
            await createImage(i, yearAndWeek[0].toString());
          }
        }
        ref.onSnapshot(async (querySnapshot) => {
          let images = [];
          let index = 0;

          querySnapshot.forEach((doc) => {
            index++;
            images.push(Object.assign({}, doc.data(), { id: doc.id, label: getLabel(index) }));
          });
          const yearAndWeek = getYearAndWeek(new Date());

          const context = { images: images };
          if (!window.handlebarsTemplate) {
            window.handlebarsTemplate = document.querySelector("#entry-template").innerHTML;
          }
          const template = Handlebars.compile(window.handlebarsTemplate);
          document.querySelector("#gallery").innerHTML = template(context);
          // addAnimation();
        });
      });

    }

    function getLabel(index) {
      let label = "";
      if (index < 9) {
        label = "0" + index;
      } else {
        label = label + index;
      }
      return label;
    }

    async function createImage(week, year) {
      try {
        await firebase.firestore().collection("images").add({
          uid: firebase.auth().currentUser.uid,
          week: week,
          year: year
        });
      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    }

    async function addImage(event) {
      try {
        event.preventDefault();
        const file = document.querySelector(`#addimageinput-${event.target.dataset.id}`).files[0];
        const storageRef = firebase.storage().ref();
        const yearAndWeek = getYearAndWeek(new Date());
        const fileName = `${firebase.auth().currentUser.uid}/${yearAndWeek[0]}/${yearAndWeek[1]}-${getUUID()}`;
        const snapshot = await storageRef.child(fileName).put(file, {
          contentDisposition: `attachment; filename="${file.name}"`
        });
        const downloadUrl = await snapshot.ref.getDownloadURL();
        await firebase.firestore().collection("images").doc(event.target.dataset.id).update({
          imagePath: snapshot.ref.fullPath,
          downloadUrl: downloadUrl
        });
      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    }

    function getYearAndWeek(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      let yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      let weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      return [d.getUTCFullYear(), weekNo];
    }

    async function deleteImage(event) {
      event.preventDefault();
      try {
        const doc = await firebase.firestore().collection("images").doc(event.target.dataset.id).get();
        if (doc.exists) {
          var data = doc.data();
          await firebase.storage().ref().child(data.imagePath).delete();
          await firebase.firestore().collection("images").doc(event.target.dataset.id).update({
            imagePath: null,
            downloadUrl: null
          });
        }
      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    }

    function getUUID() {
      let date = new Date().getTime();
      const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        let randomNumber = (date + Math.random() * 16) % 16 | 0;
        date = Math.floor(date / 16);
        return (c == 'x' ? randomNumber : (randomNumber & 0x3 | 0x8)).toString(16);
      });
      return uuid;
    }

    function addAnimation() {
      $(".currentweek").click(function () {
        $("#week").toggleClass("visible");
      });
      $("#gallery .image").click(function () {
        $(this).toggleClass("active");
        $(this).toggleClass("inactive");
      });
      $("#waitinglist a").click(function () {
        $("#loginfield")
          .addClass("down")
          .removeClass("up");
      });
      $("#loginfield #closecross").click(function () {
        $("#loginfield")
          .addClass("up")
          .removeClass("down");
      });
      $(".currentyear, #yearfull").click(function () {
        $("#year").toggleClass("visible");
      });
      $("#download").click(function () {
        $("#downloadtype").toggleClass("visible");
      });
      $("#view").click(function () {
        $(".inactive").hide();
      });
      $("#all").click(function () {
        $(".inactive").show();
        $("#gallery .image").addClass("inactive");
        $("#gallery .image").removeClass("active");
      });
      document.querySelector(".fullscreen").addEventListener("click", () => {
        if (screenfull.enabled) {
          screenfull.request();
          $("header, footer, .captionbar").addClass("invisible");
          $("article").addClass("fullsize");
        } else {
        }
      });

      document.querySelector(".cross").addEventListener("click", () => {
        if (screenfull.enabled) {
          screenfull.exit();
          $("header, footer, .captionbar").removeClass("invisible");
          $("article").removeClass("fullsize");
        } else {
        }
      });
    }
    // Check that service workers are registered
    // if ('serviceWorker' in navigator) {
    //   // Use the window load event to keep the page load performant
    //   window.addEventListener('load', () => {
    //     navigator.serviceWorker.register('/sw.js');
    //   });
    // }
  </script>
  <script type="application/javascript"> var piioData = { appKey: 'sgnclp', encodeSrc: false, domain: 'https://beta.01p-w.com' } </script>
  <script src="https://js.piio.co/sgnclp/piio.min.js"></script>
</body>

</html>