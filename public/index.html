<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>01p-w</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <meta content="01p-w is the outcome of an in-depth research about the essence of photography, its influence on the construction of identity and the instruments for archiving imagery
	in the past and athe present. 01p-w is neither a further social network nor another app to publicly exhibit your private photos – 01p-w does just the opposite. It stands
	for radical limitation in a world of unlimited noise, for a conscious engagement with photography; a medium once a word of almost magical properties described as an
	emanation of reality." name="description">
  <meta content="01p-w" name="author">
  <meta content="http://01p-w.com/img/fb.png" property="og:image">
  <meta content="01p-w" property="og:title">
  <meta content="http://01p-w.com" property="og:url">
  <meta content="01p-w is the outcome of an in-depth research about the essence of photography, its influence on the construction of identity and the instruments for archiving imagery
	in the past and the present. 01p-w is neither a further social network nor another app to publicly exhibit your private photos – 01p-w does just the opposite. It stands
	for radical limitation in a world of unlimited noise, for a conscious engagement with photography; a medium once a word of almost magical properties described as an
  emanation of reality." property="og:description">
  <link href="./css/style.css" rel="stylesheet">
  <link href="./favicon.png" rel="shortcut icon">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.runtime.min.js"></script>
  <script src="./js/templates/templates.js"></script>
  <script defer src="./js/fullscreen.js"></script>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/5.2.0/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/5.2.0/firebase-auth.js"></script>
  <script defer src="/__/firebase/5.2.0/firebase-storage.js"></script>
  <script defer src="/__/firebase/5.2.0/firebase-firestore.js"></script>
  <!-- initialize the SDK after all desired features are loaded -->
  <script defer src="/__/firebase/init.js"></script>
</head>

<body>
  <header>
    <h1 id="logo">
      <a href="/" alt="Home">01p-w</a>
    </h1>
    <h1 id="user" class="hidden"></h1>
    <h1 id="logout" class="hidden">
      <a href="" onclick="signOut()">Logout</a>
    </h1>
  </header>
	<div id="description">
<p>01p-w is the outcome of an in-depth research about the essence of photography, its influence on the construction of identity and the instruments for archiving imagery in the past and the present. 01p-w is neither an additional social network nor another app to publicly exhibit your private photos&mdash;01p-w does just the opposite. It stands for radical limitation in a world of unlimited noise, for conscious engagement with photography; a medium once a word of almost magical properties, described as an emanation of reality.</p>
</div> 

  <div id="loginfield" class="up">
    <div id="lfield">
      <div id="closecross">
        <a href="" onclick="return false">
          <img src="img/greycross.png" />
        </a>
      </div>
      <form name="login" id="loginform" onsubmit="signIn(event)">
        <table>
          <tr>
            <td>Email
              <br>
              <input id="login_email" type="email" name="email" required>
            </td>
          </tr>
          <tr>
		  <td>Password <span id="forgotpw"><a href="">Forgot it?</span></a>
              <br>
              <input id="login_password" type="password" name="password" required>
            </td>
          </tr>
          <tr>
            <td>
              <div id="rememberme" class="checkbox">

                <input type="checkbox" id="rememberme" name="rememberme" />
                <label for="rememberme">
                  Remember me</label>
              </div>
              <div class="submit">
                <input type="submit" class="submitbutton" value="Login">
              </div>
            </td>
          </tr>
        </table>
      </form>
      <div>
        <p id="login_error"></p>
      </div>
    </div>
    <div id="rfield">
      <form name="registration" id="registrationform" onsubmit="signUp(event)">
        <table>
          <tr>
            <td>
              <h2>Create an account</h2>
            </td>
          </tr>
          <tr>
            <td>First name
              <br>
              <input id="signup_firstname" type="text" name="firstname" required>
            </td>
          </tr>
          <tr>
            <td>Last name
              <br>
              <input id="signup_lastname" type="text" name="lastname" required>
            </td>
          </tr>
          <tr>
            <td>Email
              <br>
              <input id="signup_email" type="email" name="email" required>
            </td>
          </tr>
          <tr>
            <td>Confirm email
              <br>
              <input id="signup_confirmemail" type="email" name="confirmemail" required>
            </td>
          </tr>
          <tr>
            <td>Password
              <br>
              <input id="signup_password" type="password" name="password" required>
            </td>
          </tr>
          <tr>
            <td>Confirm password
              <br>
              <input id="signup_confirmpassword" type="password" name="confirmpassword" required>
            </td>
          </tr>
          <tr>
            <td>
              <div id="policy" class="checkbox">
                <input id="signup_policy" type="checkbox" id="policy" name="policy" />
                <label for="policy">
                  I accept and have read the privacy
                  <br>policy and the membership policy.</label>
              </div>
              <div class="submit">
                <input type="submit" class="submitbutton" value="Sign up">
              </div>
            </td>
          </tr>
        </table>
      </form>
      <div>
        <p id="signup_error"></p>
      </div>
    </div>
  </div>
  <footer>
    <div id="captionbar">
     <!-- <span id="all">All</span>
      <span id="yearfull">
        2018</span>
      <span id="quit">
        <a href="/2018/01" alt="Quit">Quit</a>
      </span>-->
    </div>
   <!-- <ul class="dropdown" id="year">
      <a href="https://01p-w.com/2018" alt="2018">
        <li>2018</li>
      </a>
    </ul>-->
  </footer>
  <div id="gallery" class="hidden">
    <!--template defined in ./js/templates/image.handlebars will be inserted here-->
  </div>
  <!--<div id="popup" class="hidden">
    <!--
		<p>Do you want to delete this image?</p>
		<br>
		<button>Yes</button>
    <button>No</button>-->
   <!-- <form name="addimage" id="addimageform" onsubmit="addImage(event)">
      <label for="caption">Füge einen Titel hinzu:</label>
      </br>
      <input type="text" id="caption" name="caption" required>
      </br>
      <label id="imagelabel" for="image"></label>
      <input type="file" id="image" name="image" accept="image/*" required>
      </br>
      <input type="submit" id="addimagebutton" value="Bild hinzufügen">
    </form>-->

  </div>-->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      try {
        setImageLabel();
        let app = firebase.app();
        const firestore = firebase.firestore();
        const settings = { timestampsInSnapshots: true };
        firestore.settings(settings);

        firebase.auth().onAuthStateChanged((user) => {
          if (user) {
            toggleUI();
            if (!user.displayName) {
              user.updateProfile({
                displayName: `${document.user.firstname} ${document.user.lastname}`
              }).then(function () {
                document.querySelector("#user").textContent = user.displayName;
              });
            } else {
              document.querySelector("#user").textContent = user.displayName;
            }

            getImagesByUserId(user.uid);
          }
        });

      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    });

    function signIn(event) {
      event.preventDefault();
      const email = document.querySelector("#login_email").value;
      const password = document.querySelector("#login_password").value;
      firebase.auth().signInWithEmailAndPassword(email, password).catch((error) => {
        console.error(`(signIn): (${error.code}) ${error.message}`);
        document.querySelector("#login_error").innerHTML = "Benutzername oder Passwort ist ungültig.";
      });
    }

    function signOut() {
      firebase.auth().signOut().then(function () {
        toggleUI();
      });
    }

    function signUp(event) {
      event.preventDefault();
      const user = {
        firstname: document.querySelector("#signup_firstname").value,
        lastname: document.querySelector("#signup_lastname").value,
        email: document.querySelector("#signup_email").value,
        confirmemail: document.querySelector("#signup_confirmemail").value,
        password: document.querySelector("#signup_password").value,
        confirmpassword: document.querySelector("#signup_confirmpassword").value,
        policy: document.querySelector("#signup_policy").checked
      };

      if (validateSignUpForm(user)) {
        firebase.auth().createUserWithEmailAndPassword(user.email, user.password).catch((error) => {
          console.error(`(signUp): (${error.code}) ${error.message}`);
          signup_error("Es ist ein Fehler bei der Registrierung aufgetreten.");
        });
        document.user = user;
      }
    }

    function validateSignUpForm(user) {
      if (!user.firstname || !user.lastname || !user.email || !user.confirmemail || !user.password || !user.confirmpassword) {
        signup_error("Bitte alle Felder ausfüllen");
        return false;
      }
      if (user.email !== user.confirmemail) {
        signup_error("Email Adressen stimmen nicht überein");
        return false;
      }
      if (user.password !== user.confirmpassword) {
        signup_error("Passwörter stimmen nicht überein");
        return false;
      }
      if (user.policy !== true) {
        signup_error("Privacy und membership policy muss akzeptiert werden.");
        return false;
      }
      return true;
    }

    function signup_error(message) {
      document.querySelector("#signup_error").innerHTML = message;
    }

    function toggleUI() {
      const elements = ["#user", "#logout", "#loginfield", "#gallery", "#popup", "#description"];
      for (const element of elements) {
        document.querySelector(element).classList.toggle("hidden");
      }
    }

    function getImagesByUserId(userId) {
      firebase.firestore().collection("images").where("uid", "==", userId).orderBy("year").orderBy("week").onSnapshot((querySnapshot) => {
        let images = [];
        let index = 0;
        querySnapshot.forEach((doc) => {
          index++;
          images.push(Object.assign({}, doc.data(), { id: doc.id, label: getLabel(index) }));
        });
        const context = { images: images };
        if (images.length > 0) {
          document.querySelector("#gallery").innerHTML = Handlebars.templates.image(context);
        } else {
          document.querySelector("#gallery").innerHTML = "Kein Bilder vorhanden. Füge den erstes Bild hinzu!"
        }
        addAnimation();
      });
    }

    function getLabel(index) {
      let label = "";
      if (index < 9) {
        label = "0" + index;
      } else {
        label = label + index;
      }
      return label;
    }

    async function addImage(event) {
      try {
        event.preventDefault();
        document.querySelector("#addimagebutton").disabled = true;
        const file = document.querySelector("#image").files[0];
        const storageRef = firebase.storage().ref();
        const yearAndWeek = getYearAndWeek(new Date());
        const fileName = `${firebase.auth().currentUser.uid}/${yearAndWeek[0]}/${yearAndWeek[1]}-${getUUID()}`;
        const snapshot = await storageRef.child(fileName).put(file);
        const downloadUrl = await snapshot.ref.getDownloadURL();
        await firebase.firestore().collection("images").add({
          caption: document.querySelector("#caption").value,
          imagePath: snapshot.ref.fullPath,
          downloadUrl: downloadUrl,
          uid: firebase.auth().currentUser.uid,
          week: yearAndWeek[1].toString(),
          year: yearAndWeek[0].toString()
        });
        document.querySelector("#caption").value = "";
        document.querySelector("#image").value = "";
        document.querySelector("#addimagebutton").disabled = false;
      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    }

    function getYearAndWeek(d) {
      d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      let yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1)); event.preventDefault();
      let weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      return [d.getUTCFullYear(), weekNo];
    }

    function setImageLabel() {
      const yearAndWeek = getYearAndWeek(new Date());
      document.querySelector("#imagelabel").innerHTML = `Lade dein Bild für die Woche ${yearAndWeek[1]}/${yearAndWeek[0]} hoch:`;
    }

    async function deleteImage(event) {
      event.preventDefault();
      try {
        const doc = await firebase.firestore().collection("images").doc(event.target.dataset.id).get();
        if (doc.exists) {
          var data = doc.data();
          await firebase.storage().ref().child(data.imagePath).delete();
          await firebase.firestore().collection("images").doc(event.target.dataset.id).delete();
        }
      } catch (error) {
        console.error(`(error): ${JSON.stringify(error)}`);
      }
    }

    function getUUID() {
      let date = new Date().getTime();
      const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        let randomNumber = (date + Math.random() * 16) % 16 | 0;
        date = Math.floor(date / 16);
        return (c == 'x' ? randomNumber : (randomNumber & 0x3 | 0x8)).toString(16);
      });
      return uuid;
    }

    function addAnimation() {
      $(".currentweek").click(function () {
        $("#week").toggleClass("visible");
      });
      $("#gallery .image").click(function () {
        $(this).toggleClass("active");
        $(this).toggleClass("inactive");
      });
      $("#waitinglist a").click(function () {
        $("#loginfield")
          .addClass("down")
          .removeClass("up");
      });
      $("#loginfield #closecross").click(function () {
        $("#loginfield")
          .addClass("up")
          .removeClass("down");
      });
      $(".currentyear, #yearfull").click(function () {
        $("#year").toggleClass("visible");
      });
      $("#download").click(function () {
        $("#downloadtype").toggleClass("visible");
      });
      $("#view").click(function () {
        $(".inactive").hide();
      });
      $("#all").click(function () {
        $(".inactive").show();
        $("#gallery .image").addClass("inactive");
        $("#gallery .image").removeClass("active");
      });
      document.querySelector(".fullscreen").addEventListener("click", () => {
        if (screenfull.enabled) {
          screenfull.request();
          $("header, footer, .captionbar").addClass("invisible");
          $("article").addClass("fullsize");
        } else {
        }
      });

      document.querySelector(".cross").addEventListener("click", () => {
        if (screenfull.enabled) {
          screenfull.exit();
          $("header, footer, .captionbar").removeClass("invisible");
          $("article").removeClass("fullsize");
        } else {
        }
      });
    }
    // Check that service workers are registered
    // if ('serviceWorker' in navigator) {
    //   // Use the window load event to keep the page load performant
    //   window.addEventListener('load', () => {
    //     navigator.serviceWorker.register('/sw.js');
    //   });
    // }
  </script>
  <script type="application/javascript"> var piioData = { appKey: 'sgnclp', encodeSrc: false, domain: 'https://beta.01p-w.com' } </script>
  <script src="https://js.piio.co/sgnclp/piio.min.js"></script>
</body>

</html>
